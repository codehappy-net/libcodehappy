/***

	stats.cpp

	Functions for statistical tests (chi-squared/Pearson test, e.g.)

	Copyright (c) 2022 Chris Street.

***/

/***

	Perform a Pearson chi-squared test.

	Inputs:
		npoints		Number of data buckets
		observed	Observed frequency of each bucket
		expected	Expected frequency of each bucket
	Input outputs:
		test_stat_out	if non-NULL, the chi-squared test static will be filled in at this address
	Return value:
		The p-value of the test (i.e. likelihood that the observed frequencies are consistent
		with the expected frequencies)

***/
double pearson_chisq_test(u32 npoints, double* observed, double* expected, double* test_stat_out) {
	double cv = 0.0, chi;
	for (u32 e = 0; e < npoints; ++e) {
		if (expected[e] <= 0.0)
			continue;
		chi = observed[e] - expected[e];
		cv += ((chi * chi) / expected[e]);
	}
	if (!is_null(test_stat_out))
		*test_stat_out = cv;
	return chisqr_p_val(npoints - 1, cv);
}

/* Z-score to p-value conversion: cumulative probability to the left of [positive] Z-score, in increments of 0.005 starting
   from 0 up to 7.0. */
static double __ztop_left[1401] = {
0.5, 0.501994703090741, 0.503989356314632, 0.505983909808562, 0.507978313716902, 0.509972518195238, 0.511966473414113, 0.513960129562758, 
0.515953436852831, 0.517946345522139, 0.519938805838372, 0.521930768102823, 0.523922182654107, 0.525912999871874, 0.527903170180521, 0.529892644052895, 
0.531881372013987, 0.533869304644629, 0.535856392585172, 0.537842586539166, 0.539827837277029, 0.541812095639705, 0.543795312542317, 0.54577743897781, 
0.547758426020584, 0.549738224830113, 0.551716786654561, 0.553694062834382, 0.555670004805906, 0.557644564104923, 0.559617692370243, 0.561589341347247, 
0.563559462891433, 0.565528008971935, 0.567494931675038, 0.569460183207674, 0.571423715900901, 0.573385482213374, 0.575345434734795, 0.577303526189345, 
0.579259709439103, 0.581213937487448, 0.583166163482442, 0.585116340720196, 0.587064422648215, 0.58901036286873, 0.590954115142006, 0.592895633389633, 
0.594834871697796, 0.596771784320524, 0.598706325682924, 0.600638450384383, 0.602568113201761, 0.604495269092554, 0.606419873198039, 0.608341880846395, 
0.610261247555797, 0.612177929037499, 0.614091881198877, 0.616003060146465, 0.617911422188953, 0.619816923840165, 0.621719521822019, 0.623619173067451, 
0.62551583472332, 0.627409464153284, 0.629300018940654, 0.631187456891215, 0.633071736036028, 0.634952814634198, 0.636830651175619, 0.638705204383687, 
0.640576433217991, 0.642444296876971, 0.644308754800547, 0.646169766672724, 0.648027292424163, 0.649881292234724, 0.651731726535982, 0.653578556013708, 
0.655421741610324, 0.657261244527326, 0.659097026227677, 0.660929048438169, 0.66275727315175, 0.66458166262983, 0.666402179404542, 0.668218786280981, 
0.670031446339406, 0.671840122937415, 0.67364477971208, 0.675445380582055, 0.677241889749652, 0.679034271702878, 0.680822491217444, 0.682606513358741, 
0.684386303483777, 0.686161827243089, 0.687933050582609, 0.689699939745512, 0.691462461274013, 0.693220582011142, 0.694974269102481, 0.69672348999786, 
0.698468212453034, 0.700208404531304, 0.701944034605124, 0.703675071357656, 0.705401483784302, 0.707123241194195, 0.708840313211654, 0.710552669777606, 
0.712260281150973, 0.713963117910021, 0.715661150953676, 0.717354351502799, 0.719042691101436, 0.720726141618017, 0.722404675246535, 0.724078264507678, 
0.725746882249926, 0.727410501650623, 0.729069096216994, 0.730722639787146, 0.732371106531017, 0.734014470951299, 0.735652707884322, 0.737285792500899, 
0.738913700307138, 0.74053640714522, 0.742153889194135, 0.743766122970388, 0.745373085328664, 0.746974753462462, 0.74857110490469, 0.750162117528223, 
0.75174776954643, 0.753328039513658, 0.754902906325691, 0.756472349220159, 0.758036347776927, 0.759594881918435, 0.761147931910013, 0.762695478360153, 
0.764237502220749, 0.765773984787305, 0.767304907699103, 0.768830252939335, 0.770350002835209, 0.77186414005801, 0.773372647623132, 0.774875508890073, 
0.776372707562401, 0.777864227687676, 0.77935005365735, 0.780830170206623, 0.782304562414267, 0.783773215702424, 0.785236115836363, 0.786693248924201, 
0.788144601416603, 0.789590160106436, 0.791029912128398, 0.792463844958612, 0.793891946414187, 0.795314204652747, 0.796730608171932, 0.798141145808856, 
0.79954580673955, 0.800944580478358, 0.802337456877308, 0.803724426125456, 0.805105478748192, 0.806480605606519, 0.807849797896304, 0.809213047147489, 
0.810570345223288, 0.811921684319337, 0.813267056962827, 0.814606456011606, 0.81593987465324, 0.817267306404068, 0.818588745108203, 0.819904184936523, 
0.821213620385628, 0.822517046276768, 0.823814457754742, 0.825105850286778, 0.826391219661376, 0.827670561987128, 0.828943873691518, 0.830211151519684, 
0.831472392533162, 0.832727594108605, 0.83397675393647, 0.83521987001969, 0.836456940672308, 0.837687964518101, 0.838912940489169, 0.840131867824506, 
0.841344746068543, 0.842551575069672, 0.843752354978745, 0.84494708624755, 0.846135769627265, 0.84731840616689, 0.848494997211656, 0.849665544401419, 
0.850830049669019, 0.851988515238634, 0.853140943624104, 0.854287337627236, 0.85542770033609, 0.856562035123249, 0.857690345644061, 0.858812635834871, 
0.859928909911231, 0.861039172366089, 0.862143427967965, 0.863241681759104, 0.864333939053617, 0.865420205435604, 0.866500486757253, 0.867574789136934, 
0.868643118957269, 0.869705482863191, 0.870761887759982, 0.871812340811303, 0.872856849437202, 0.873895421312116, 0.87492806436285, 0.87595478676655, 
0.876975596948657, 0.877990503580851, 0.878999515578982, 0.880002642100988, 0.880999892544799, 0.881991276546237, 0.882976803976891, 0.883956484941997, 
0.884930329778292, 0.88589834905187, 0.886860553556023, 0.887816954309066, 0.888767562552165, 0.889712389747149, 0.890651447574308, 0.891584747930196, 
0.892512302925413, 0.893434124882387, 0.894350226333145, 0.895260620017078, 0.8961653188787, 0.897064336065398, 0.897957684925181, 0.898845379004414, 
0.899727432045558, 0.900603857984894, 0.901474670950252, 0.902339885258725, 0.90319951541439, 0.904053576106012, 0.904902082204761, 0.905745048761907, 
0.906582491006528, 0.907414424343205, 0.908240864349719, 0.909061826774746, 0.909877327535548, 0.910687382715663, 0.911492008562598, 0.912291221485514, 
0.913085038052915, 0.913873474990337, 0.914656549178033, 0.915434277648664, 0.916206677584986, 0.916973766317537, 0.917735561322331, 0.918492080218549, 
0.919243340766229, 0.919989360863966, 0.920730158546608, 0.921465751982952, 0.922196159473454, 0.922921399447928, 0.923641490463261, 0.92435645120112, 
0.925066300465673, 0.925771057181306, 0.926470740390352, 0.927165369250814, 0.927854963034106, 0.928539541122789, 0.929219123008314, 0.929893728288777, 
0.930563376666668, 0.931228087946641, 0.931887882033275, 0.932542778928853, 0.933192798731142, 0.933837961631183, 0.934478287911084, 0.935113797941823, 
0.935744512181064, 0.936370451170967, 0.936991635536022, 0.937608085980877, 0.938219823288188, 0.938826868316467, 0.939429241997941, 0.940026965336427, 
0.940620059405207, 0.941208545344917, 0.941792444361447, 0.942371777723847, 0.942946566762246, 0.94351683286578, 0.944082597480531, 0.944643882107474, 
0.945200708300442, 0.94575309766409, 0.94630107185188, 0.946844652564077, 0.947383861545748, 0.94791872058478, 0.948449251509911, 0.948975476188762, 
0.949497416525896, 0.950015094460879, 0.950528531966352, 0.951037751046126, 0.951542773733277, 0.952043622088264, 0.952540318197053, 0.953032884169254, 
0.95352134213628, 0.954005714249506, 0.95448602267845, 0.954962289608969, 0.955434537241457, 0.955902787789073, 0.956367063475968, 0.956827386535536, 
0.957283779208671, 0.957736263742048, 0.958184862386405, 0.958629597394854, 0.959070491021193, 0.95950756551824, 0.959940843136183, 0.960370346120936, 
0.960796096712517, 0.961218117143443, 0.961636429637129, 0.962051056406311, 0.962462019651483, 0.962869341559346, 0.963273044301274, 0.963673150031791, 
0.964069680887074, 0.964462658983457, 0.964852106415961, 0.965238045256835, 0.96562049755411, 0.965999485330178, 0.966375030580372, 0.966747155271575, 
0.967115881340836, 0.967481230694006, 0.967843225204386, 0.968201886711395, 0.968557237019247, 0.968909297895654, 0.969258091070534, 0.969603638234739, 
0.9699459610388, 0.970285081091689, 0.970621019959591, 0.970953799164693, 0.971283440183998, 0.971609964448141, 0.971933393340228, 0.972253748194692, 
0.972571050296163, 0.97288532087835, 0.973196581122945, 0.973504852158537, 0.973810155059547, 0.974112510845175, 0.974411940478361, 0.97470846486477, 
0.97500210485178, 0.975292881227496, 0.975580814719777, 0.975865925995275, 0.976148235658492, 0.976427764250851, 0.976704532249788, 0.976978560067852, 
0.977249868051821, 0.97751847648184, 0.977784405570569, 0.978047675462342, 0.978308306232353, 0.978566317885847, 0.978821730357328, 0.979074563509785, 
0.97932483713393, 0.979572570947455, 0.979817784594296, 0.98006049764392, 0.980300729590623, 0.980538499852842, 0.980773827772483, 0.981006732614261, 
0.981237233565062, 0.981465349733307, 0.981691100148341, 0.981914503759832, 0.982135579437183, 0.982354345968963, 0.982570822062343, 0.982785026342557, 
0.982996977352367, 0.983206693551551, 0.983414193316395, 0.983619494939205, 0.983822616627834, 0.984023576505213, 0.98422239260891, 0.984419082890685, 
0.984613665216075, 0.98480615736398, 0.984996577026268, 0.98518494180739, 0.985371269224011, 0.985555576704649, 0.985737881589331, 0.985918201129262, 
0.986096552486501, 0.986272952733655, 0.98644741885358, 0.986619967739103, 0.986790616192744, 0.98695938092646, 0.987126278561398, 0.987291325627654, 
0.987454538564053, 0.987615933717936, 0.987775527344955, 0.987933335608887, 0.988089374581453, 0.98824366024215, 0.988396208478097, 0.988547035083885, 
0.988696155761447, 0.988843586119932, 0.988989341675589, 0.989133437851667, 0.989275889978324, 0.98941671329254, 0.989555922938049, 0.989693533965275, 
0.98982956133128, 0.989964019899726, 0.990096924440836, 0.990228289631376, 0.990358130054642, 0.990486460200453, 0.990613294465161, 0.990738647151664, 
0.990862532469427, 0.990984964534522, 0.991105957369663, 0.991225524904262, 0.991343680974483, 0.991460439323318, 0.991575813600654, 0.991689817363366, 
0.991802464075404, 0.991913767107898, 0.992023739739266, 0.992132395155331, 0.992239746449446, 0.992345806622627, 0.992450588583691, 0.992554105149408, 
0.992656369044652, 0.992757392902565, 0.992857189264729, 0.992955770581335, 0.993053149211376, 0.993149337422829, 0.993244347392859, 0.993338191208017, 
0.993430880864453, 0.993522428268132, 0.993612845235057, 0.993702143491497, 0.993790334674224, 0.993877430330752, 0.993963441919587, 0.994048380810476, 
0.994132258284667, 0.994215085535176, 0.994296873667049, 0.994377633697647, 0.994457376556917, 0.994536113087683, 0.994613854045933, 0.994690610101117, 
0.994766391836444, 0.994841209749191, 0.994915074251009, 0.994987995668239, 0.995059984242229, 0.995131050129661, 0.995201203402874, 0.995270454050196, 
0.995338811976281, 0.995406287002451, 0.995472888867033, 0.995538627225712, 0.995603511651879, 0.995667551636987, 0.995730756590911, 0.995793135842303, 
0.995854698638964, 0.99591545414821, 0.995975411457242, 0.996034579573521, 0.996092967425147, 0.996150583861239, 0.996207437652315, 0.996263537490682, 
0.996318891990825, 0.996373509689794, 0.9964273990476, 0.996480568447614, 0.996533026196959, 0.996584780526918, 0.996635839593331, 0.996686211477002, 
0.996735904184109, 0.996784925646606, 0.996833283722642, 0.996880986196967, 0.99692804078135, 0.996974455114991, 0.997020236764945, 0.997065393226535, 
0.997109931923774, 0.997153860209787, 0.997197185367235, 0.997239914608738, 0.997282055077299, 0.997323613846734, 0.997364597922095, 0.997405014240103, 
0.997444869669572, 0.997484171011844, 0.997522925001214, 0.997561138305369, 0.997598817525811, 0.997635969198297, 0.997672599793268, 0.997708715716285, 
0.997744323308458, 0.997779428846885, 0.997814038545087, 0.997848158553436, 0.997881794959595, 0.997914953788954, 0.99794764100506, 0.997979862510054, 
0.998011624145106, 0.998042931690848, 0.998073790867812, 0.998104207336859, 0.998134186699616, 0.998163734498908, 0.998192856219194, 0.998221557286993, 
0.998249843071324, 0.998277718884132, 0.998305189980723, 0.998332261560189, 0.998358938765843, 0.998385226685646, 0.998411130352635, 0.99843665474535, 
0.998461804788262, 0.998486585352197, 0.998511001254763, 0.99853505726077, 0.99855875808266, 0.99858210838092, 0.998605112764508, 0.998627775791272, 
0.99865010196837, 0.998672095752682, 0.998693761551231, 0.998715103721596, 0.998736126572328, 0.998756834363357, 0.998777231306408, 0.998797321565408, 
0.998817109256896, 0.998836598450426, 0.998855793168977, 0.998874697389354, 0.998893315042591, 0.998911650014349, 0.998929706145321, 0.998947487231624, 
0.998964997025197, 0.998982239234196, 0.998999217523386, 0.99901593551453, 0.999032396786782, 0.99904860487707, 0.999064563280486, 0.999080275450667, 
0.999095744800178, 0.999110974700892, 0.999125968484368, 0.999140729442231, 0.999155260826541, 0.99916956585017, 0.999183647687171, 0.999197509473149, 
0.999211154305624, 0.999224585244402, 0.999237805311933, 0.999250817493673, 0.999263624738446, 0.999276229958798, 0.999288636031355, 0.99930084579717, 
0.999312862062084, 0.999324687597065, 0.99933632513856, 0.99934777738884, 0.99935904701634, 0.999370136656002, 0.999381048909613, 0.99939178634614, 
0.999402351502066, 0.99941274688172, 0.999422974957609, 0.999433038170747, 0.999442938930975, 0.999452679617292, 0.99946226257817, 0.999471690131877, 
0.999480964566793, 0.999490088141723, 0.999499063086214, 0.999507891600861, 0.999516575857616, 0.999525118000098, 0.999533520143892, 0.999541784376854, 
0.999549912759408, 0.999557907324845, 0.999565770079618, 0.999573503003636, 0.99958110805055, 0.999588587148047, 0.999595942198136, 0.999603175077427, 
0.999610287637418, 0.999617281704773, 0.9996241590816, 0.999630921545725, 0.999637570850967, 0.999644108727408, 0.999650536881662, 0.999656856997142, 
0.999663070734323, 0.999669179731007, 0.999675185602581, 0.999681089942275, 0.999686894321419, 0.999692600289695, 0.999698209375391, 0.999703723085649, 
0.999709142906709, 0.999714470304162, 0.999719706723184, 0.999724853588783, 0.999729912306036, 0.999734884260326, 0.999739770817572, 0.999744573324471, 
0.99974929310872, 0.999753931479245, 0.999758489726432, 0.999762969122349, 0.999767370920964, 0.999771696358373, 0.999775946653009, 0.999780123005865, 
0.999784226600705, 0.999788258604277, 0.999792220166519, 0.999796112420775, 0.999799936483993, 0.999803693456932, 0.999807384424364, 0.999811010455277, 
0.999814572603067, 0.999818071905737, 0.999821509386095, 0.999824886051939, 0.999828202896254, 0.999831460897396, 0.99983466101928, 0.999837804211567, 
0.999840891409842, 0.999843923535802, 0.999846901497426, 0.999849826189161, 0.999852698492093, 0.999855519274119, 0.999858289390124, 0.999861009682148, 
0.999863680979554, 0.999866304099195, 0.999868879845579, 0.999871409011033, 0.999873892375862, 0.999876330708508, 0.999878724765715, 0.999881075292673, 
0.999883383023185, 0.999885648679809, 0.999887872974018, 0.999890056606342, 0.999892200266523, 0.999894304633653, 0.999896370376326, 0.999898398152777, 
0.999900388611024, 0.999902342389008, 0.999904260114731, 0.999906142406393, 0.999907989872526, 0.999909803112129, 0.999911582714799, 0.999913329260862, 
0.999915043321502, 0.999916725458887, 0.999918376226297, 0.999919996168249, 0.999921585820616, 0.999923145710755, 0.999924676357621, 0.99992617827189, 
0.999927651956075, 0.99992909790464, 0.99993051660412, 0.999931908533228, 0.99993327416297, 0.999934613956757, 0.999935928370511, 0.999937217852774, 
0.999938482844817, 0.99993972378074, 0.999940941087581, 0.999942135185418, 0.999943306487466, 0.999944455400183, 0.999945582323366, 0.999946687650249, 
0.999947771767598, 0.99994883505581, 0.999949877889004, 0.999950900635114, 0.999951903655982, 0.99995288730745, 0.999953851939444, 0.999954797896068, 
0.999955725515688, 0.99995663513102, 0.999957527069211, 0.99995840165193, 0.999959259195441, 0.999960100010695, 0.999960924403402, 0.999961732674115, 
0.999962525118309, 0.999963302026454, 0.999964063684097, 0.999964810371934, 0.999965542365885, 0.999966259937168, 0.999966963352371, 0.999967652873523, 
0.999968328758167, 0.999968991259426, 0.999969640626073, 0.999970277102602, 0.999970900929288, 0.999971512342259, 0.999972111573559, 0.999972698851211, 
0.999973274399281, 0.999973838437939, 0.999974391183526, 0.999974932848606, 0.999975463642034, 0.999975983769007, 0.999976493431131, 0.999976992826471, 
0.999977482149611, 0.999977961591709, 0.999978431340552, 0.999978891580609, 0.999979342493088, 0.999979784255983, 0.999980217044132, 0.999980641029263, 
0.999981056380049, 0.999981463262154, 0.999981861838282, 0.999982252268229, 0.999982634708926, 0.999983009314491, 0.99998337623627, 0.999983735622886, 
0.999984087620281, 0.999984432371764, 0.999984770018052, 0.999985100697313, 0.999985424545209, 0.999985741694938, 0.999986052277273, 0.999986356420606, 
0.999986654250984, 0.999986945892151, 0.999987231465586, 0.99998751109054, 0.999987784884075, 0.999988052961099, 0.999988315434405, 0.999988572414706, 
0.999988824010668, 0.999989070328947, 0.999989311474225, 0.999989547549238, 0.999989778654816, 0.99999000488991, 0.999990226351627, 0.999990443135263, 
0.99999065533433, 0.999990863040591, 0.999991066344087, 0.99999126533317, 0.999991460094529, 0.999991650713221, 0.999991837272697, 0.999992019854835, 
0.999992198539962, 0.999992373406883, 0.999992544532909, 0.999992711993881, 0.999992875864198, 0.999993036216842, 0.999993193123401, 0.999993346654094, 
0.999993496877799, 0.999993643862072, 0.999993787673173, 0.999993928376089, 0.999994066034554, 0.999994200711077, 0.999994332466958, 0.999994461362313, 
0.999994587456092, 0.999994710806107, 0.999994831469043, 0.999994949500485, 0.999995064954938, 0.999995177885839, 0.999995288345588, 0.999995396385556, 
0.999995502056111, 0.999995605406633, 0.99999570648553, 0.999995805340262, 0.999995902017353, 0.99999599656241, 0.99999608902014, 0.999996179434364, 
0.99999626784804, 0.999996354303269, 0.99999643884132, 0.999996521502642, 0.999996602326875, 0.999996681352873, 0.999996758618713, 0.999996834161709, 
0.999996908018431, 0.999996980224715, 0.999997050815677, 0.999997119825729, 0.999997187288588, 0.999997253237295, 0.99999731770422, 0.999997380721083, 
0.999997442318961, 0.999997502528298, 0.999997561378926, 0.999997618900067, 0.99999767512035, 0.99999773006782, 0.999997783769952, 0.999997836253657, 
0.999997887545298, 0.999997937670696, 0.999997986655145, 0.999998034523419, 0.99999808129978, 0.999998127007994, 0.999998171671336, 0.9999982153126, 
0.99999825795411, 0.999998299617725, 0.999998340324856, 0.999998380096465, 0.999998418953081, 0.999998456914806, 0.999998494001322, 0.999998530231902, 
0.999998565625416, 0.999998600200337, 0.999998633974755, 0.999998666966379, 0.999998699192546, 0.999998730670229, 0.999998761416043, 0.999998791446253, 
0.999998820776783, 0.999998849423218, 0.999998877400815, 0.999998904724505, 0.999998931408906, 0.999998957468322, 0.999998982916757, 0.999999007767914, 
0.999999032035204, 0.999999055731752, 0.999999078870404, 0.999999101463729, 0.999999123524027, 0.999999145063336, 0.999999166093434, 0.999999186625846, 
0.999999206671848, 0.999999226242475, 0.999999245348521, 0.999999264000549, 0.999999282208893, 0.999999299983662, 0.999999317334747, 0.999999334271824, 
0.999999350804357, 0.999999366941606, 0.999999382692628, 0.999999398066282, 0.999999413071236, 0.999999427715963, 0.999999442008757, 0.999999455957724, 
0.999999469570797, 0.999999482855731, 0.999999495820112, 0.999999508471358, 0.999999520816723, 0.999999532863303, 0.999999544618035, 0.999999556087702, 
0.999999567278938, 0.999999578198229, 0.999999588851916, 0.999999599246201, 0.999999609387146, 0.999999619280678, 0.999999628932592, 0.999999638348554, 
0.999999647534102, 0.99999965649465, 0.999999665235492, 0.9999996737618, 0.999999682078634, 0.999999690190935, 0.999999698103538, 0.999999705821163, 
0.999999713348428, 0.999999720689845, 0.999999727849823, 0.999999734832671, 0.999999741642602, 0.999999748283732, 0.999999754760082, 0.999999761075583, 
0.999999767234077, 0.999999773239316, 0.999999779094968, 0.999999784804616, 0.999999790371761, 0.999999795799825, 0.999999801092149, 0.999999806251999, 
0.999999811282566, 0.999999816186965, 0.999999820968243, 0.999999825629372, 0.999999830173259, 0.999999834602742, 0.999999838920594, 0.999999843129522, 
0.999999847232172, 0.999999851231127, 0.999999855128911, 0.999999858927988, 0.999999862630766, 0.999999866239595, 0.99999986975677, 0.999999873184535, 
0.999999876525079, 0.999999879780539, 0.999999882953003, 0.99999988604451, 0.99999988905705, 0.999999891992567, 0.99999989485296, 0.99999989764008, 
0.999999900355737, 0.999999903001697, 0.999999905579684, 0.999999908091382, 0.999999910538435, 0.999999912922445, 0.99999991524498, 0.999999917507568, 
0.999999919711701, 0.999999921858836, 0.999999923950395, 0.999999925987764, 0.999999927972299, 0.999999929905321, 0.999999931788121, 0.999999933621956, 
0.999999935408057, 0.999999937147621, 0.99999993884182, 0.999999940491795, 0.99999994209866, 0.999999943663502, 0.999999945187383, 0.999999946671337, 
0.999999948116374, 0.99999994952348, 0.999999950893617, 0.999999952227721, 0.999999953526709, 0.999999954791473, 0.999999956022884, 0.999999957221791, 
0.999999958389024, 0.99999995952539, 0.999999960631679, 0.999999961708659, 0.999999962757081, 0.999999963777676, 0.999999964771158, 0.999999965738224, 
0.999999966679551, 0.999999967595804, 0.999999968487626, 0.999999969355647, 0.999999970200482, 0.99999997102273, 0.999999971822974, 0.999999972601784, 
0.999999973359714, 0.999999974097307, 0.99999997481509, 0.999999975513577, 0.999999976193271, 0.99999997685466, 0.999999977498221, 0.999999978124419, 
0.999999978733708, 0.999999979326529, 0.999999979903313, 0.999999980464479, 0.999999981010438, 0.999999981541587, 0.999999982058315, 0.999999982561002, 
0.999999983050017, 0.999999983525719, 0.999999983988461, 0.999999984438582, 0.999999984876418, 0.999999985302292, 0.99999998571652, 0.999999986119412, 
0.999999986511268, 0.999999986892379, 0.999999987263033, 0.999999987623507, 0.999999987974071, 0.999999988314989, 0.999999988646519, 0.999999988968912, 
0.99999998928241, 0.999999989587252, 0.999999989883669, 0.999999990171888, 0.999999990452127, 0.999999990724601, 0.999999990989519, 0.999999991247083, 
0.999999991497492, 0.999999991740938, 0.999999991977608, 0.999999992207686, 0.99999999243135, 0.999999992648773, 0.999999992860124, 0.999999993065567, 
0.999999993265263, 0.999999993459367, 0.999999993648031, 0.999999993831404, 0.999999994009629, 0.999999994182846, 0.999999994351191, 0.999999994514799, 
0.999999994673797, 0.999999994828313, 0.999999994978468, 0.999999995124383, 0.999999995266172, 0.999999995403951, 0.999999995537828, 0.99999999566791, 
0.999999995794303, 0.999999995917108, 0.999999996036423, 0.999999996152346, 0.999999996264969, 0.999999996374384, 0.999999996480679, 0.999999996583941, 
0.999999996684254, 0.9999999967817, 0.999999996876358, 0.999999996968306, 0.999999997057619, 0.99999999714437, 0.999999997228631, 0.999999997310472, 
0.999999997389959, 0.999999997467159, 0.999999997542135, 0.99999999761495, 0.999999997685664, 0.999999997754337, 0.999999997821024, 0.999999997885783, 
0.999999997948668, 0.99999999800973, 0.999999998069022, 0.999999998126593, 0.999999998182492, 0.999999998236766, 0.999999998289461, 0.999999998340622, 
0.999999998390292, 0.999999998438513, 0.999999998485327, 0.999999998530772, 0.99999999857489, 0.999999998617716, 0.999999998659288, 0.999999998699641, 
0.99999999873881, 0.99999999877683, 0.999999998813732, 0.999999998849549, 0.999999998884312, 0.999999998918051, 0.999999998950795, 0.999999998982573, 
0.999999999013412, 0.99999999904334, 0.999999999072383, 0.999999999100566, 0.999999999127915, 0.999999999154452, 0.999999999180202, 0.999999999205187, 
0.999999999229429, 0.99999999925295, 0.999999999275771, 0.999999999297912, 0.999999999319392, 0.999999999340232, 0.999999999360449, 0.999999999380061, 
0.999999999399087, 0.999999999417543, 0.999999999435447, 0.999999999452813, 0.999999999469658, 0.999999999485997, 0.999999999501844, 0.999999999517215, 
0.999999999532123, 0.999999999546582, 0.999999999560605, 0.999999999574204, 0.999999999587393, 0.999999999600182, 0.999999999612585, 0.999999999624613, 
0.999999999636275, 0.999999999647584, 0.99999999965855, 0.999999999669183, 0.999999999679492, 0.999999999689488, 0.999999999699179, 0.999999999708575, 
0.999999999717684, 0.999999999726515, 0.999999999735077, 0.999999999743377, 0.999999999751423, 0.999999999759222, 0.999999999766782, 0.999999999774111, 
0.999999999781215, 0.9999999997881, 0.999999999794774, 0.999999999801242, 0.999999999807511, 0.999999999813587, 0.999999999819476, 0.999999999825183, 
0.999999999830714, 0.999999999836073, 0.999999999841267, 0.9999999998463, 0.999999999851177, 0.999999999855903, 0.999999999860482, 0.999999999864919, 
0.999999999869218, 0.999999999873384, 0.999999999877419, 0.999999999881329, 0.999999999885117, 0.999999999888787, 0.999999999892343, 0.999999999895787, 
0.999999999899123, 0.999999999902355, 0.999999999905486, 0.999999999908519, 0.999999999911456, 0.999999999914301, 0.999999999917057, 0.999999999919726, 
0.999999999922311, 0.999999999924815, 0.99999999992724, 0.999999999929589, 0.999999999931863, 0.999999999934065, 0.999999999936198, 0.999999999938263, 
0.999999999940263, 0.9999999999422, 0.999999999944075, 0.999999999945891, 0.999999999947649, 0.999999999949351, 0.999999999950999, 0.999999999952594, 
0.999999999954139, 0.999999999955634, 0.999999999957082, 0.999999999958483, 0.99999999995984, 0.999999999961153, 0.999999999962425, 0.999999999963655, 
0.999999999964846, 0.999999999965999, 0.999999999967115, 0.999999999968195, 0.999999999969241, 0.999999999970252, 0.999999999971231, 0.999999999972179, 
0.999999999973096, 0.999999999973984, 0.999999999974842, 0.999999999975673, 0.999999999976478, 0.999999999977256, 0.999999999978009, 0.999999999978737, 
0.999999999979442, 0.999999999980124, 0.999999999980784, 0.999999999981422, 0.99999999998204, 0.999999999982638, 0.999999999983216, 0.999999999983775, 
0.999999999984316, 0.999999999984839, 0.999999999985345, 0.999999999985835, 0.999999999986309, 0.999999999986767, 0.99999999998721, 0.999999999987638, 
0.999999999988053, 0.999999999988454, 0.999999999988841, 0.999999999989216, 0.999999999989579, 0.99999999998993, 0.999999999990269, 0.999999999990597, 
0.999999999990914, 0.99999999999122, 0.999999999991517, 0.999999999991804, 0.999999999992081, 0.999999999992349, 0.999999999992608, 0.999999999992858, 
0.9999999999931, 0.999999999993335, 0.999999999993561, 0.99999999999378, 0.999999999993991, 0.999999999994196, 0.999999999994393, 0.999999999994584, 
0.999999999994769, 0.999999999994947, 0.99999999999512, 0.999999999995287, 0.999999999995448, 0.999999999995604, 0.999999999995754, 0.9999999999959, 
0.99999999999604, 0.999999999996176, 0.999999999996308, 0.999999999996434, 0.999999999996557, 0.999999999996675, 0.99999999999679, 0.9999999999969, 
0.999999999997007, 0.999999999997111, 0.99999999999721, 0.999999999997307, 0.9999999999974, 0.99999999999749, 0.999999999997577, 0.999999999997661, 
0.999999999997742, 0.99999999999782, 0.999999999997896, 0.999999999997969, 0.999999999998039, 0.999999999998108, 0.999999999998174, 0.999999999998237, 
0.999999999998299, 0.999999999998358, 0.999999999998415, 0.999999999998471, 0.999999999998524, 0.999999999998576, 0.999999999998626, 0.999999999998674, 
0.99999999999872, 
};


/* Given a z-score (the number of standard deviations from the mean), give the cumulative normal probability to the left of
   (smaller than) that z value. */
double prob_zscore_left(double z) {
	if (z < 0.) {
		return 1.0 - prob_zscore_left(-z);
	}
	if (z > 7.) {
		return 1.0;
	}
	int ibin = (int)floor(z / 0.005);
	if (ibin >= 1400)
		return __ztop_left[1400];
	double bins = double(ibin) * 0.005, wt;
	wt = (z - bins) / 0.005;

	return __ztop_left[ibin] * (1.0 - wt) + __ztop_left[ibin + 1] * wt;
}

/* Given a z-score (the number of standard deviations from the mean), give the cumulative normal probability to the right of
   (larger than) that z value. */
double prob_zscore_right(double z) {
	return 1.0 - prob_zscore_left(z);
}

/* Given a z-score (the number of standard deviations from the mean), give the total normal probability within that many 
   standard deviations of the mean (below or above, as in a two-tail test.) */
double prob_zscore_within(double z) {
	z = fabs(z);
	return 1.0 - prob_zscore_right(z) - prob_zscore_left(-z);
}

/* Given a z-score (the number of standard deviations from the mean), give the total normal probability above that many 
   standard deviations of the mean (below or above, as in a two-tail test.) */
double prob_zscore_beyond(double z) {
	return 1.0 - prob_zscore_within(z);
}

/* Some code below lifted from Jacob F. Wells (contributed to the public domain:)
    https://www.codeproject.com/articles/432194/how-to-calculate-the-chi-squared-p-value */

/* The inverse gamma function. */
static double igf(double S, double Z) {
	const int MAX_ITER = 200;
	if (Z <= 0.0)
		return 0.0;
	double Sc = (1.0 / S);
	Sc *= pow(Z, S);
	Sc *= exp(-Z);

	double Sum = 1.0;
	double Nom = 1.0;
	double Denom = 1.0;
 
	for(int I = 0; I < MAX_ITER; I++) {
		Nom *= Z;
		S++;
		Denom *= S;
		Sum += (Nom / Denom);
	}

	return Sum * Sc;
}

/* The gamma function. */
double gammaf(double N) {
#if 0
	// what is "A"?
	const long double SQRT2PI = 2.5066282746310005024157652848110452530069867406099383L;
	long double Z = (long double)N;
	long double Sc = powl((Z + A), (Z + 0.5));
	Sc *= expl(-1.0 * (Z + A));
	Sc /= Z;
	long double F = 1.0L;
	long double Ck;
	long double Sum = SQRT2PI;
 
	for (int K = 1; K < A; K++) {
		Z++;
		Ck = powl(A - K, K - 0.5);
		Ck *= expl(A - K);
		Ck /= F;

		Sum += (Ck / Z);
 		F *= (-1.0 * K);
	}
	return (double)(Sum * Sc);
#else
	return tgamma(N);
#endif
}

/* Fast approximation to the gamma function. */
double approx_gamma(double Z) {
	const double RECIP_E = 0.36787944117144232159552377016147;	/* RECIP_E = (E^-1) = (1.0 / E) */
	const double TWOPI = 6.283185307179586476925286766559;		/* TWOPI = 2.0 * PI */
	double D = 1.0 / (10.0 * Z);

	D = 1.0 / ((12 * Z) - D);
	D = (D + Z) * RECIP_E;
	D = pow(D, Z);
	D *= sqrt(TWOPI / Z);
 
	return D;
}


/* Dof = degrees of freedom, Cv = critical value (chi^2 test statistic)
   output = p-value (probability that the test statistic will equal or exceed Cv) */
double chisqr_p_val(int Dof, double Cv, bool use_approx) {
	if (Cv < 0 || Dof < 1) {
		return 0.0;
	}
	double K = ((double)Dof) * 0.5;
	double X = Cv * 0.5;
	if (2 == Dof) {
		return exp(-1.0 * X);
	}

	double PValue = igf(K, X);
	if(isnan(PValue) || isinf(PValue) || PValue <= 1e-8) {
		return 1e-14;
	}

	if (use_approx)
		PValue /= approx_gamma(K);
	else
		PValue /= gammaf(K);
	
	return (1.0 - PValue);
}

/* Calculate the standard variance (and mean, if desired) of a data set. */
double standard_variance(double* points, u32 npoints, double* mean_out) {
	double m = 0.0, v = 0.0;
	u32 e;

	if (0 == npoints) {
		if (!is_null(mean_out))
			*mean_out = 0.;
		return 0.;
	}
	for (e = 0; e < npoints; ++e) {
		m += points[e];
	}
	m /= double(npoints);
	if (!is_null(mean_out))
		*mean_out = m;

	for (e = 0; e < npoints; ++e) {
		v += (points[e] - m) * (points[e] - m);
	}
	v /= double(npoints);
	return v;
}

double standard_variance(const std::vector<double>& points, double* mean_out) {
	u32 npoints = points.size();
	double m = 0.0, v = 0.0;

	if (0 == npoints) {
		if (!is_null(mean_out))
			*mean_out = 0.;
		return 0.;
	}

	for (const double pt : points) {
		m += pt;
	}
	m /= double(npoints);
	if (!is_null(mean_out))
		*mean_out = m;

	for (const double pt : points) {
		v += (pt - m) * (pt - m);
	}
	v /= double(npoints);
	return v;
}

/* Calculate the standard deviation (and mean, if desired) of a data set. */
double standard_deviation(double* points, u32 npoints, double* mean_out) {
	return sqrt(standard_variance(points, npoints, mean_out));
}

double standard_deviation(const std::vector<double>& points, double* mean_out) {
	return sqrt(standard_variance(points, mean_out));
}

/* end stats.cpp */